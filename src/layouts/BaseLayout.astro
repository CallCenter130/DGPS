---
// --- BLOQUE DE CÓDIGO ACTUALIZADO ---
// Importamos TODOS los componentes de layout que podríamos necesitar.
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Sidebar from '../components/Sidebar.astro'; // Nuevo componente
import '../styles/global.css'; 

export interface Props {
    title: string;
    description: string;
}

const { title, description } = Astro.props;

// Leemos la URL para detectar si estamos en modo "embed".
const urlParams = new URLSearchParams(Astro.url.search);
const isEmbed = urlParams.get('embed') === 'true';

// Corregimos la ruta del favicon para que funcione en ambos modos
const faviconUrl = `${import.meta.env.BASE_URL.replace(/\/$/, '')}/favicon.svg`;

// Helper function to format URLs with BASE_URL
function formatUrl(path: string) {
    return `${import.meta.env.BASE_URL.replace(/\/$/, '')}${path}`;
}
// --- FIN DEL BLOQUE DE CÓDIGO ACTUALIZADO ---
---
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href={faviconUrl} />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={description} />
    <title>{title}</title>

    <!-- Las fuentes de Google no cambian -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
</head>
<!-- 
    Aplicamos clases condicionales al <body>.
    En modo embed, queremos que ocupe toda la altura de la pantalla.
-->
<body class:list={[
    "bg-light text-dark font-sans antialiased",
    isEmbed && "h-screen overflow-hidden"
]}>
    
    <!-- Lógica de renderizado condicional -->
    {isEmbed ? (
        // MODO EMBEBIDO: Layout con Sidebar (barra lateral)
        <div x-data="{ isSidebarOpen: false }" class="flex h-screen bg-gray-100">
    <!-- El Sidebar ahora es controlado por el estado del div padre -->
    <Sidebar />
    
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Barra superior SOLO para móviles, contiene el botón hamburguesa -->
        <header class="md:hidden flex justify-between items-center bg-white p-4 border-b">
            <a href={formatUrl('/?embed=true')} class="flex items-center space-x-2">
                <img src={`${import.meta.env.BASE_URL.replace(/\/$/, '')}/images/logomtps.svg`} alt="Logo DGPS" class="h-8 w-8" />
                <span class="font-display font-bold text-lg text-primary">DGPS</span>
            </a>
            <button @click="isSidebarOpen = true" class="p-2">
                <svg class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </header>

        <!-- Contenido Principal -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto">
            <div class="p-4 sm:p-6 md:p-8">
                <slot />
            </div>
        </main>
            </div>
        </div>
    ) : (
        // MODO NORMAL: Layout con Header y Footer (encabezado y pie de página)
        <div class="flex flex-col min-h-screen">
        <Header />
        <main class="flex-grow">
            <slot />
        </main>
        <Footer />
    </div>
    )}

</body>
</html>