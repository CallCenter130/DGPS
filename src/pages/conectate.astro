---
import BaseLayout from '../layouts/BaseLayout.astro';
---
<BaseLayout 
    title="Contacto | Dirección General de Previsión Social"
    description="Contacte a nuestros técnicos, consulte nuestra ubicación o programe una cita a través de nuestro portal oficial."
>
    <section class="py-16 bg-light">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            
            <div class="text-center mb-12">
                <h1 class="font-display text-4xl md:text-5xl font-bold text-primary">Canales de Contacto</h1>
                <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Comuníquese con la Dirección General de Previsión Social a través de nuestros canales oficiales.</p>
            </div>

            <!-- Fila Superior de Tarjetas (Centradas) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16 text-center">
                <!-- Tarjeta 1: Google Chat -->
                <div class="bg-white p-8 rounded-lg border border-gray-200 shadow-sm flex flex-col items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-4 text-accent" viewBox="0 0 24 24" fill="currentColor"><path d="M12.431,11.314V12.9h3.755a3.64,3.64,0,0,1-1.54,2.365v2.03h2.6a8.472,8.472,0,0,0,2.585-6.395c0-.525-.047-.95-.14-1.375Zm0,0Z" style="fill:#34a853"></path><path d="M7.75,14.28a4.93,4.93,0,0,0,3.315,1.24c1.8,0,3.33-1.125,4.01-2.715H12.43v-2.1H7.75Zm0,0Z" style="fill:#4285f4"></path><path d="M12,4.5A7,7,0,0,0,5.08,8.26l-2.7.9A9.923,9.923,0,0,1,12,2.5c2.93,0,5.61,1.13,7.58,3l-2.31,2.31A6.9,6.9,0,0,0,12,4.5Zm0,0Z" style="fill:#ea4335"></path><path d="M12,18a9.921,9.921,0,0,1-8.06-4.14l-2.61.87A7,7,0,0,0,12,21.5a6.885,6.885,0,0,0,6.48-4.5h-2.1A4.93,4.93,0,0,1,12,18Zm0,0Z" style="fill:#fbbc04"></path></svg>
                    <h3 class="text-xl font-bold text-dark mb-2">Chat Directo</h3>
                    <a href="https://mail.google.com/chat/u/0/#chat/space/AAQA-1au-dc" target="_blank" rel="noopener noreferrer" class="font-semibold text-primary hover:text-accent transition">Iniciar Conversación</a>
                </div>
                 <!-- Tarjeta 2: Email -->
                 <div class="bg-white p-8 rounded-lg border border-gray-200 shadow-sm flex flex-col items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                    <h3 class="text-xl font-bold text-dark mb-2">Correo Electrónico</h3>
                    <a href="mailto:previsionsocial@mtps.gob.sv" class="font-semibold text-primary hover:text-accent transition">previsionsocial@mtps.gob.sv</a>
                </div>
                 <!-- Tarjeta 3: Llamadas -->
                 <div class="bg-white p-8 rounded-lg border border-gray-200 shadow-sm flex flex-col items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                    <h3 class="text-xl font-bold text-dark mb-2">Teléfonos</h3>
                    <p class="text-gray-600 mb-4 text-sm">Consulte nuestra lista de contactos directos.</p>
                </div>
            </div>

            <!-- Fila Inferior (Formulario y Ubicación/Teléfonos) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                
                <!-- Columna Izquierda: Formulario Dinámico -->
                <div x-data="{ tipocita: 'consulta' }" class="bg-white p-6 sm:p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold text-center text-dark mb-6">Solicitudes en Línea</h2>
                    <form id="contact-form">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="md:col-span-2">
                                <label for="tipocita" class="block text-sm font-medium text-gray-700">Tipo de Gestión</label>
                                <select id="tipocita" name="tipocita" x-model="tipocita" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                                    <option value="consulta">Consulta General</option>
                                    <option value="cita">Solicitar Cita</option>
                                </select>
                            </div>
                            <template x-if="tipocita === 'cita'">
                                <div class="grid grid-cols-2 gap-6 md:col-span-2">
                                    <div>
                                        <label for="fechacita" class="block text-sm font-medium text-gray-700">Fecha Sugerida</label>
                                        <input type="date" name="fechacita" id="fechacita" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                                    </div>
                                    <div>
                                        <label for="horacita" class="block text-sm font-medium text-gray-700">Hora Sugerida</label>
                                        <input type="time" name="horacita" id="horacita" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                                    </div>
                                </div>
                            </template>
                            <div><label for="name" class="block text-sm font-medium text-gray-700">Nombre Completo</label><input type="text" name="name" id="name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                            <div><label for="company" class="block text-sm font-medium text-gray-700">Empresa</label><input type="text" name="company" id="company" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                            <div><label for="email" class="block text-sm font-medium text-gray-700">Email Corporativo</label><input type="email" name="email" id="email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                            <div><label for="phone" class="block text-sm font-medium text-gray-700">Teléfono</label><input type="tel" name="phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                            <div class="md:col-span-2"><label for="interest" class="block text-sm font-medium text-gray-700">Área de Interés</label><select id="interest" name="interest" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"><option>Consulta General</option><option>Riesgo Psicosocial</option><option>Sistema SNNAT</option><option>Seguridad y Salud Ocupacional</option><option>Peritos y Acreditaciones</option><option>Generadores de Vapor</option></select></div>
                            <div class="md:col-span-2"><label for="message" class="block text-sm font-medium text-gray-700">Mensaje / Motivo de la Cita</label><textarea id="message" name="message" rows="4" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></textarea></div>
                        </div>
                        <div class="text-center mt-6">
                            <button type="submit" id="submit-button" class="bg-accent text-primary font-bold py-3 px-8 rounded-md hover:bg-yellow-600 transition-colors duration-300">Enviar Solicitud</button>
                        </div>
                    </form>
                    <div id="form-status" class="text-center mt-4 font-semibold"></div>
                </div>

                <!-- Columna Derecha: Mapa y Lista de Teléfonos -->
                <div class="space-y-8">
                     <div class="bg-white p-6 rounded-lg shadow-lg">
                        <h2 class="text-2xl font-bold text-dark mb-4">Nuestra Ubicación</h2>
                        <p class="text-gray-600 mb-6 text-sm">Alameda Juan Pablo II y 17 Ave. Nte. Edificios 2, 3 y 4, Centro de Gobierno, San Salvador.</p>
                        <div class="aspect-video rounded-lg shadow-inner overflow-hidden">
                            <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d7752.3983801064105!2d-89.2065772!3d13.7063826!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f62b78ca90cf287%3A0x509c8f65e22ac085!2sMinisterio%20de%20Trabajo%20y%20Previsi%C3%B3n%20Social!5e0!3m2!1ses-419!2ssv!4v1756825782839!5m2!1ses-419!2ssv" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                        </div>
                    </div>
                     <div class="bg-white p-6 sm:p-8 rounded-lg shadow-lg">
                        <h2 class="text-2xl font-bold text-dark mb-6 border-b pb-4">Contactos Telefónicos</h2>
                        <dl class="space-y-6">
                           <!-- Item 1: Medidas Sustitutivas -->
                            <div class="flex flex-col sm:flex-row"><dt class="w-full sm:w-1/2 font-semibold text-gray-800">Medidas Sustitutivas:</dt><dd class="w-full sm:w-1/2 mt-1 sm:mt-0"><a href="tel:+50322404132" class="block font-medium text-primary hover:text-accent transition">(+503) 2240-4132</a></dd></div>
                            <!-- Item 2: Comité SSO -->
                            <div class="flex flex-col sm:flex-row"><dt class="w-full sm:w-1/2 font-semibold text-gray-800">Comité SSO:</dt><dd class="w-full sm:w-1/2 mt-1 sm:mt-0 space-y-1"><a href="tel:+50325293998" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3998</a><a href="tel:+50325293999" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3999</a></dd></div>
                            <!-- Item 3: Peritos y Empresas Asesoras -->
                            <div class="flex flex-col sm:flex-row"><dt class="w-full sm:w-1/2 font-semibold text-gray-800">Peritos y Empresas:</dt><dd class="w-full sm:w-1/2 mt-1 sm:mt-0 space-y-1"><a href="tel:+50325293874" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3874</a><a href="tel:+50325293894" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3894</a></dd></div>
                            <!-- Item 4: Generadores de Vapor -->
                            <div class="flex flex-col sm:flex-row"><dt class="w-full sm:w-1/2 font-semibold text-gray-800">Generadores de Vapor:</dt><dd class="w-full sm:w-1/2 mt-1 sm:mt-0 space-y-1"><a href="tel:+50325293824" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3824</a><a href="tel:+50325293892" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3892</a></dd></div>
                        </dl>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <script is:inline>
        const gasUrl = 'https://script.google.com/macros/s/AKfycbycSOV9eFeWHmMg2E7TTsoDvcy-Vk2quaRIcTjWmymKj2otSJ6omsC7LOolgKgQZEuH/exec';
        const apiToken = 'DgPs_SeCrEt_ApI_KeY_2024!#';

        document.addEventListener('submit', async (e) => {
            if (e.target.id !== 'contact-form') {
            return;
            }

            e.preventDefault();
            const form = e.target;
            const submitButton = form.querySelector('#submit-button');
            const formStatus = document.querySelector('#form-status');
            
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando...';
            formStatus.textContent = '';
            formStatus.className = 'text-center mt-4 font-semibold';

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            data.token = apiToken;

            // --- MEJORA CLAVE: FORMATEAR FECHA Y HORA AQUÍ ---
            if (data.tipocita === 'cita' && data.fechacita && data.horacita) {
            // Formatear Fecha (ej: "12 de septiembre de 2025")
            const fechaObj = new Date(data.fechacita + 'T00:00:00'); // Añadir T00:00:00 para evitar problemas de zona horaria
            data.fechacita_formateada = fechaObj.toLocaleDateString('es-SV', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                timeZone: 'UTC' // Usar UTC aquí para que la fecha no cambie
            });

            // Formatear Hora (ej: "02:26 PM")
            const [horas, minutos] = data.horacita.split(':');
            const horaObj = new Date();
            horaObj.setHours(horas, minutos, 0, 0);
            data.horacita_formateada = horaObj.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
            }
            // --- FIN DE LA MEJORA ---

            try {
            // Volvemos al fetch que funcionaba, sin 'no-cors' para poder leer la respuesta
            const response = await fetch(gasUrl, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(data),
            });
            
            if (!response.ok) {
                throw new Error(`Error del servidor: ${response.status} ${response.statusText}`);
            }
            
            const result = await response.json();

            if (result.result === 'success') {
                formStatus.textContent = '¡Gracias! Su solicitud ha sido enviada exitosamente.';
                formStatus.className += ' text-green-600';
                Array.from(form.elements).forEach(element => element.disabled = true);
                submitButton.style.display = 'none';
                setTimeout(() => window.location.reload(), 3000);
            } else {
                throw new Error(result.details || 'Ocurrió un error reportado por el servidor.');
            }
            } catch (error) {
            formStatus.textContent = 'Hubo un problema con el envío. Por favor, intente de nuevo.';
            formStatus.className += ' text-red-600';
            console.error('Error en el envío del formulario:', error);
            submitButton.disabled = false;
            submitButton.textContent = 'Enviar Solicitud';
            }
        });
    </script>
</BaseLayout>