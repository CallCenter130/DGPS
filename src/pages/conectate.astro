---
import BaseLayout from '../layouts/BaseLayout.astro';
---
<BaseLayout 
    title="Conéctate | Iniciemos una Conversación Estratégica | DGPS"
    description="Contacte a nuestros expertos a través de llamada, email, chat o programando una consulta. Estamos listos para proponer soluciones a su medida en Previsión Social."
>
    <section class="bg-light py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- 1. Encabezado Impactante -->
            <div class="text-center mb-12">
                <h1 class="font-display text-4xl md:text-5xl font-bold text-primary">
                    Iniciemos una Conversación Estratégica
                </h1>
                <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">
                    Elija el canal que prefiera para conectar con nuestros expertos. Estamos listos para analizar sus necesidades y proponer soluciones a la medida.
                </p>
            </div>

            <!-- 2. Múltiples Vías de Contacto -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16 text-center">
                <!-- Tarjeta 1: Llamada -->
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                    <h3 class="text-xl font-bold text-dark mb-2">Llamada Inmediata</h3>
                    <p class="text-gray-600 mb-4">Para consultas urgentes o hablar directamente con un consultor.</p>
                    <a href="tel:+50322404132" class="font-semibold text-primary hover:text-accent transition">Llamar al (+503) 2240-4132</a>
                </div>
                <!-- Tarjeta 2: Email -->
                 <div class="bg-white p-8 rounded-lg shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                    <h3 class="text-xl font-bold text-dark mb-2">Consulta por Email</h3>
                    <p class="text-gray-600 mb-4">Ideal para consultas detalladas. Respuesta en &lt; 24 h hábiles.</p>
                    <a href="mailto:previsionsocial@mtps.gob.sv" class="font-semibold text-primary hover:text-accent transition">previsionsocial@mtps.gob.sv</a>
                </div>
                <!-- Tarjeta 3: Google Chat -->
            <div class="bg-white p-8 rounded-lg shadow-md">
                <!-- Icono de Google Chat -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" viewBox="0 0 24 24" fill="currentColor"><path d="M12.431,11.314V12.9h3.755a3.64,3.64,0,0,1-1.54,2.365v2.03h2.6a8.472,8.472,0,0,0,2.585-6.395c0-.525-.047-.95-.14-1.375Zm0,0Z" style="fill:#34a853"></path><path d="M7.75,14.28a4.93,4.93,0,0,0,3.315,1.24c1.8,0,3.33-1.125,4.01-2.715H12.43v-2.1H7.75Zm0,0Z" style="fill:#4285f4"></path><path d="M12,4.5A7,7,0,0,0,5.08,8.26l-2.7.9A9.923,9.923,0,0,1,12,2.5c2.93,0,5.61,1.13,7.58,3l-2.31,2.31A6.9,6.9,0,0,0,12,4.5Zm0,0Z" style="fill:#ea4335"></path><path d="M12,18a9.921,9.921,0,0,1-8.06-4.14l-2.61.87A7,7,0,0,0,12,21.5a6.885,6.885,0,0,0,6.48-4.5h-2.1A4.93,4.93,0,0,1,12,18Zm0,0Z" style="fill:#fbbc04"></path></svg>
                <h3 class="text-xl font-bold text-dark mb-2">Chat Directo</h3>
                <p class="text-gray-600 mb-4">Inicie una conversación a través de Google Chat.</p>
                <a href="https://mail.google.com/chat/u/0/#chat/space/AAQA-1au-dc" target="_blank" rel="noopener noreferrer" class="font-semibold text-primary hover:text-accent transition">Iniciar Conversación</a>
            </div>
                <!-- 4. Ubicación Física (Opcional) -->
            <!-- Si tienes una dirección, descomenta y rellena este bloque -->
            
            <div class="bg-white p-8 rounded-lg shadow-md">
                 <h2 class="text-2xl font-bold text-dark mb-4">Visite Nuestras Oficinas</h2>
                 <p class="text-gray-600 mb-6">Alameda Juan Pablo II y 17 Ave. Nte. Edificios 2, 3 y 4, Centro de Gobierno, San Salvador Centro, San Salvador, El Salvador</p>
                 <div class="max-w-4xl mx-auto aspect-video rounded-lg shadow-lg overflow-hidden">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d7752.3983801064105!2d-89.2065772!3d13.7063826!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f62b78ca90cf287%3A0x509c8f65e22ac085!2sMinisterio%20de%20Trabajo%20y%20Previsi%C3%B3n%20Social!5e0!3m2!1ses-419!2ssv!4v1756825782839!5m2!1ses-419!2ssv" width="100%" height="200%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                 </div>
            </div>

            <!-- 3. Formulario de Contacto Inteligente -->
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-center text-dark mb-6">O Agende una Consulta Programada</h2>
                
                <form id="contact-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                            <input type="text" name="name" id="name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                        </div>
                        <div>
                            <label for="company" class="block text-sm font-medium text-gray-700">Empresa</label>
                            <input type="text" name="company" id="company" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Email Corporativo</label>
                            <input type="email" name="email" id="email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700">Teléfono</label>
                            <input type="tel" name="phone" id="phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                        </div>
                        <div>
                            <label for="interest" class="block text-sm font-medium text-gray-700">Área de Interés</label>
                            <select id="interest" name="interest" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                                <option>Consulta General</option>
                                <option>Riesgo Psicosocial</option>
                                <option>Sistema SNNAT</option>
                                <option>Seguridad y Salud Ocupacional</option>
                                <option>Peritos y Acreditaciones</option>
                                <option>Generadores de Vapor</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label for="message" class="block text-sm font-medium text-gray-700">Mensaje</label>
                            <textarea id="message" name="message" rows="4" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent"></textarea>
                        </div>
                    </div>
                    <div class="text-center mt-6">
                        <button type="submit" id="submit-button" class="bg-accent text-primary font-bold py-3 px-8 rounded-md hover:bg-yellow-600 transition-colors duration-300">
                            Solicitar Consulta
                        </button>
                    </div>
                </form>
                <!-- ¡LA LÍNEA CRÍTICA ESTÁ AQUÍ! -->
                <div id="form-status" class="text-center mt-4 font-semibold"></div>
            </div>
    </section>

    <!-- Script de JavaScript para enviar el formulario a Google Apps Script -->
    <script>
        const gasUrl = 'https://script.google.com/macros/library/d/1xMG4xj4ca0JulpdeB76sPH-X-b3m2mZrCbU8pptLLFKT71Jd_WmVjOnH/2/exec';
  
        // Esta función contiene toda la lógica. La llamaremos en el momento adecuado.
    function setupContactForm() {
    console.log('[DGPS Debug] Intentando configurar el formulario...');
    
    const form = document.getElementById('contact-form');
    const submitButton = document.getElementById('submit-button');
    const formStatus = document.getElementById('form-status');
    
    // Log para ver si encontramos los elementos
    console.log('[DGPS Debug] Formulario encontrado:', form);
    console.log('[DGPS Debug] Botón encontrado:', submitButton);
    console.log('[DGPS Debug] Status div encontrado:', formStatus);

    // Si falta algún elemento, nos detenemos.
    if (!form || !submitButton || !formStatus) {
      console.error('[DGPS Debug] ERROR: Uno o más elementos del formulario no se encontraron en el DOM. Deteniendo.');
      return;
    }

    // Evitamos añadir el listener múltiples veces
    if (form.dataset.listenerAttached === 'true') {
      console.log('[DGPS Debug] El listener ya está adjunto. No se hará nada.');
      return;
    }
    form.dataset.listenerAttached = 'true';
    console.log('[DGPS Debug] Adjuntando el EventListener de "submit"...');

    form.addEventListener('submit', async (e) => {
      // 1. Prevenir el envío normal del formulario
      e.preventDefault();
      console.log('[DGPS Debug] Envío por defecto PREVENIDO.');

      // 2. Cambiar estado del botón
      submitButton.disabled = true;
      submitButton.textContent = 'Enviando...';
      formStatus.textContent = '';
      console.log('[DGPS Debug] Botón deshabilitado. Estado: Enviando...');
      
      const formData = new FormData(form);
      console.log('[DGPS Debug] Datos del formulario capturados:', Object.fromEntries(formData.entries()));

      try {
        console.log('[DGPS Debug] Enviando datos a GAS URL:', gasUrl);
        const response = await fetch(gasUrl, {
          method: 'POST',
          body: formData,
        });
        
        console.log('[DGPS Debug] Respuesta recibida del servidor. Status:', response.status);

        if (!response.ok) {
          throw new Error(`Respuesta del servidor no fue OK: ${response.statusText}`);
        }
        
        const result = await response.json();
        console.log('[DGPS Debug] Respuesta JSON de GAS:', result);

        if (result.result === 'success') {
          console.log('[DGPS Debug] ¡ÉXITO! GAS reportó éxito.');
          formStatus.textContent = '¡Gracias! Su mensaje ha sido enviado exitosamente.';
          formStatus.className = 'text-center mt-4 font-semibold text-green-600';
          form.reset();
        } else {
          console.error('[DGPS Debug] ERROR: GAS reportó un fallo.', result.details);
          throw new Error(result.details || 'GAS reportó un error desconocido.');
        }
      } catch (error) {
        console.error('[DGPS Debug] ERROR CATASTRÓFICO en el bloque catch:', error);
        formStatus.textContent = 'Hubo un problema con el envío. Por favor, intente de nuevo.';
        formStatus.className = 'text-center mt-4 font-semibold text-red-600';
      } finally {
        console.log('[DGPS Debug] Bloque "finally" ejecutado. Reactivando botón.');
        submitButton.disabled = false;
        submitButton.textContent = 'Solicitar Consulta';
      }
    });
  }

  // Ejecutamos la función de configuración en CADA carga de página de Astro
  document.addEventListener('astro:page-load', setupContactForm);

  // Como respaldo, también la ejecutamos en la carga inicial por si astro:page-load falla
  setupContactForm();
</script>
</BaseLayout>
        </div>
    </section>
</BaseLayout>