---
import BaseLayout from '../layouts/BaseLayout.astro';
---
<BaseLayout 
    title="Conéctate | Iniciemos una Conversación Estratégica | DGPS"
    description="Contacte a nuestros expertos a través de llamada, email, chat o programando una consulta. Estamos listos para proponer soluciones a su medida en Previsión Social."
>
    <section class="bg-light py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- 1. Encabezado Impactante -->
            <div class="text-center mb-12">
                <h1 class="font-display text-4xl md:text-5xl font-bold text-primary">
                    Iniciemos una Conversación Estratégica
                </h1>
                <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">
                    Elija el canal que prefiera para conectar con nuestros expertos. Estamos listos para analizar sus necesidades y proponer soluciones a la medida.
                </p>
            </div>

            
                <!-- Tarjeta 2: Email -->
                 <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                    <h3 class="text-xl font-bold text-dark mb-2">Consulta por Email</h3>
                    <p class="text-gray-600 mb-4">Ideal para consultas detalladas. Respuesta en &lt; 24 h hábiles.</p>
                    <a href="mailto:previsionsocial@mtps.gob.sv" class="font-semibold text-primary hover:text-accent transition">previsionsocial@mtps.gob.sv</a>
                </div>
                
                <!-- 4. Ubicación Física (Opcional) -->
            <!-- Si tienes una dirección, descomenta y rellena este bloque -->
            
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                 <h2 class="text-2xl font-bold text-dark mb-4">Visite Nuestras Oficinas</h2>
                 <p class="text-gray-600 mb-6">Alameda Juan Pablo II y 17 Ave. Nte. Edificios 2, 3 y 4, Centro de Gobierno, San Salvador Centro, San Salvador, El Salvador</p>
                 <div class="max-w-4xl mx-auto aspect-video rounded-lg shadow-lg overflow-hidden">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d7752.3983801064105!2d-89.2065772!3d13.7063826!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f62b78ca90cf287%3A0x509c8f65e22ac085!2sMinisterio%20de%20Trabajo%20y%20Previsi%C3%B3n%20Social!5e0!3m2!1ses-419!2ssv!4v1756825782839!5m2!1ses-419!2ssv" width="100%" height="200%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                 </div>
            </div>

<!-- 2. Múltiples Vías de Contacto -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16 text-center">
                <!-- Tarjeta 1: Llamada -->
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                    <h3 class="text-xl font-bold text-dark mb-2">Llamada Inmediata</h3>
                    <p class="text-gray-600 mb-4">Para consultas urgentes o hablar directamente con un tecnico.</p>
                    <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md">
                    
                    <!-- Lista de Definición para los contactos -->
                    <dl class="space-y-6">

                        <!-- Item 1: Medidas Sustitutivas -->
                        <div class="flex flex-col sm:flex-row">
                            <dt class="w-full sm:w-1/3 font-semibold text-gray-800">Medidas Sustitutivas:</dt>
                            <dd class="w-full sm:w-2/3 mt-1 sm:mt-0">
                                <a href="tel:+50322404132" class="block font-medium text-primary hover:text-accent transition">(+503) 2240-4132</a>
                            </dd>
                        </div>

                        <!-- Item 2: Comité SSO -->
                        <div class="flex flex-col sm:flex-row">
                            <dt class="w-full sm:w-1/3 font-semibold text-gray-800">Comité SSO:</dt>
                            <dd class="w-full sm:w-2/3 mt-1 sm:mt-0 space-y-1">
                                <a href="tel:+50325293998" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3998</a>
                                <a href="tel:+50325293999" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3999</a>
                            </dd>
                        </div>

                        <!-- Item 3: Peritos y Empresas Asesoras -->
                        <div class="flex flex-col sm:flex-row">
                            <dt class="w-full sm:w-1/3 font-semibold text-gray-800">Peritos y Empresas Asesoras:</dt>
                            <dd class="w-full sm:w-2/3 mt-1 sm:mt-0 space-y-1">
                                <a href="tel:+50325293874" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3874</a>
                                <a href="tel:+50325293894" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3894</a>
                            </dd>
                        </div>

                        <!-- Item 4: Generadores de Vapor -->
                        <div class="flex flex-col sm:flex-row">
                            <dt class="w-full sm:w-1/3 font-semibold text-gray-800">Generadores de Vapor y Equipo a Presión:</dt>
                            <dd class="w-full sm:w-2/3 mt-1 sm:mt-0 space-y-1">
                                <a href="tel:+50325293824" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3824</a>
                                <a href="tel:+50325293892" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3892</a>
                            </dd>
                        </div>

                    </dl>
                </div>
                </div>

            <!-- 3. Formulario de Contacto Inteligente -->
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-center text-dark mb-6">O Agende una Consulta Programada</h2>
                
                <form id="contact-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                            <input type="text" name="name" id="name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                        </div>
                        <div>
                            <label for="company" class="block text-sm font-medium text-gray-700">Empresa</label>
                            <input type="text" name="company" id="company" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Email Corporativo</label>
                            <input type="email" name="email" id="email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700">Teléfono</label>
                            <input type="tel" name="phone" id="phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                        </div>
                        <div>
                            <label for="interest" class="block text-sm font-medium text-gray-700">Área de Interés</label>
                            <select id="interest" name="interest" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                                <option>Consulta General</option>
                                <option>Riesgo Psicosocial</option>
                                <option>Sistema SNNAT</option>
                                <option>Seguridad y Salud Ocupacional</option>
                                <option>Peritos y Acreditaciones</option>
                                <option>Generadores de Vapor</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label for="message" class="block text-sm font-medium text-gray-700">Mensaje</label>
                            <textarea id="message" name="message" rows="4" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent"></textarea>
                        </div>
                    </div>
                    <div class="text-center mt-6">
                        <button type="submit" id="submit-button" class="bg-accent text-primary font-bold py-3 px-8 rounded-md hover:bg-yellow-600 transition-colors duration-300">
                            Solicitar Consulta
                        </button>
                    </div>
                </form>
                <!-- ¡LA LÍNEA CRÍTICA ESTÁ AQUÍ! -->
                <div id="form-status" class="text-center mt-4 font-semibold"></div>
            </div>
    </section>

    <!-- Script de JavaScript para enviar el formulario a Google Apps Script -->
<script is:inline>
  const gasUrl = 'https://script.google.com/macros/s/AKfycbzVE4JZuVSJBPBOEd7g-2aybP5K-bVNKT_ivxObOTZ1-PiVGzxytk63smsVXFfgcf28/exec';
  const secretToken = 'DgPs_SeCrEt_ApI_KeY_2024!#';

  function setupContactForm() {
    console.log('[DGPS Debug] Intentando configurar el formulario...');
    
    const form = document.getElementById('contact-form');
    const submitButton = document.getElementById('submit-button');
    const formStatus = document.getElementById('form-status');
    
    if (!form || !submitButton || !formStatus) {
      console.error('[DGPS Debug] ERROR: Uno o más elementos del formulario no se encontraron en el DOM. Deteniendo.');
      return;
    }

    if (form.dataset.listenerAttached === 'true') {
      console.log('[DGPS Debug] El listener ya está adjunto. No se hará nada.');
      return;
    }
    form.dataset.listenerAttached = 'true';
    console.log('[DGPS Debug] Adjuntando el EventListener de "submit"...');

    form.addEventListener('submit', async (e) => {
  e.preventDefault();
  console.log('[DGPS Debug] Envío por defecto PREVENIDO.');

  submitButton.disabled = true;
  submitButton.textContent = 'Enviando...';
  formStatus.textContent = '';
  console.log('[DGPS Debug] Botón deshabilitado. Estado: Enviando...');
  
  const formData = new FormData(form);
  // Paso 1: Convertir los datos del formulario a un objeto simple.
  const data = Object.fromEntries(formData.entries());
  
  // ¡ESTA ES LA LÍNEA CRÍTICA QUE RESUELVE EL PROBLEMA!
  // Paso 2: Añadir el token secreto al objeto de datos antes de enviarlo.
  data.token = secretToken;

  console.log('[DGPS Debug] Objeto final a enviar (con token):', data);

  try {
    console.log('[DGPS Debug] Enviando datos JSON a GAS URL:', gasUrl);
    const response = await fetch(gasUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      // Paso 3: Convertir el objeto COMPLETO (con token) a una cadena JSON.
      body: JSON.stringify(data),
      // Mantenemos el modo 'no-cors' por ahora para evitar problemas de CORS con GAS.
      mode: 'no-cors', 
    });
    
    // Como usamos 'no-cors', no podemos leer la respuesta. Asumimos éxito.
    // La prueba real es que la fila aparece en la hoja de cálculo y no hay correo de error.
    console.log('[DGPS Debug] Solicitud enviada a GAS. Asumiendo éxito para la UI.');
    
    formStatus.textContent = '¡Gracias! Su mensaje ha sido enviado exitosamente.';
    formStatus.className = 'text-center mt-4 font-semibold text-green-600';
    form.reset();

  } catch (error) {
    console.error('[DGPS Debug] ERROR CATASTRÓFICO en el bloque catch:', error);
    formStatus.textContent = 'Hubo un problema con el envío. Por favor, intente de nuevo.';
    formStatus.className = 'text-center mt-4 font-semibold text-red-600';
  } finally {
    console.log('[DGPS Debug] Bloque "finally" ejecutado. Reactivando botón.');
    submitButton.disabled = false;
    submitButton.textContent = 'Solicitar Consulta';
  }
});
    console.log('[DGPS Debug] EventListener de "submit" adjuntado correctamente.');
  }

  document.addEventListener('astro:page-load', setupContactForm);
  setupContactForm();
</script>
</BaseLayout>
        </div>
    </section>
</BaseLayout>