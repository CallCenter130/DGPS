---
import BaseLayout from '../layouts/BaseLayout.astro';
---
<BaseLayout 
    title="Contacto | Dirección General de Previsión Social"
    description="Contacte a nuestros técnicos, consulte nuestra ubicación o programe una cita a través de nuestro portal oficial."
>
    <section class="py-16 bg-light">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            
            <div class="text-center mb-12">
                <h1 class="font-display text-4xl md:text-5xl font-bold text-primary">Canales de Contacto</h1>
                <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Comuníquese con la Dirección General de Previsión Social a través de nuestros canales oficiales.</p>
            </div>

            <!-- Fila Superior de Tarjetas (Centradas) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16 text-center">
                <!-- Tarjeta 1: de WhatsApp -->
                <div>
                <div class="bg-white p-8 rounded-lg border border-gray-200 shadow-sm flex flex-col items-center justify-center">
                    <!-- Icono de WhatsApp -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-4 text-green-500" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.269.655 4.512 1.924 6.341l-1.241 4.515 4.672-1.225zM12.07 9.589c-.534 0-1.064.215-1.064.215l-.013.004c-.286.11-.643.376-.87.643-.226.267-.428.57-.428.57s-.201.302-.534 1.064c-.333.762-.333 1.328 0 2.13.333.802 1.18 1.63 1.18 1.63s.851.831 2.13 1.18c.802.334 1.328.334 2.13 0 .762-.334 1.064-.534 1.064-.534s.302-.202.57-.428c.267-.227.376-.644.643-.87.11-.286.215-.534.215-.534s.215-1.064 0-2.13c-.215-1.064-1.63-2.13-1.63-2.13s-1.064-1.18-2.13-1.18zm.333 2.13c.267 0 .534.202.534.202l.013.003s.202.202.428.57c.227.267.334.644.334.644s.04.14.04.286c0 .286-.215.534-.215.534s-.202.201-.57.428c-.267.226-.644.333-.644.333s-.14.04-.286.04c-.286 0-.534-.215-.534-.215s-.201-.202-.428-.57c-.226-.267-.333-.644-.333-.644s-.04-.14-.04-.286c0-.286.215-.534.215-.534s.202-.201.57-.428c.267-.226.644-.333.644-.333l.013.003s.14.04.286.04z"/>
                    </svg>
                    <h3 class="text-xl font-bold text-dark mb-2">Chatea por WhatsApp</h3>
                    <a 
                    href="https://wa.me/50360626358" 
                    target="_blank" 
                    rel="noopener noreferrer" 
                    class="font-semibold text-primary hover:text-accent transition"
                    >
                    Iniciar Conversación
                    </a>
                </div>

                <!-- Tarjeta 2: Email -->
                 <div class="bg-white p-8 rounded-lg border border-gray-200 shadow-sm flex flex-col items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                    <h3 class="text-xl font-bold text-dark mb-2">Correo Electrónico</h3>
                    <p class="text-gray-600 mb-4">Puedes realizar tus consultas a traves de nuestro correo electronico.</p>
                    <a href="mailto:previsionsocial@mtps.gob.sv" class="font-semibold text-primary hover:text-accent transition">previsionsocial@mtps.gob.sv</a>
                </div>
            </div>
                 
                 <!-- Tarjeta 3: Llamadas -->
                 <div  class="bg-white p-8 rounded-lg border border-gray-200 shadow-sm  flex-col items-center justify-center">
                        <!-- Icono de Ubicación (Pin de mapa) -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5 14.5 7.62 14.5 9 13.38 11.5 12 11.5z"/>
                        </svg>
                        <h3 class="text-xl font-bold text-dark mb-2">Nuestra Ubicación</h3>
                    <!-- Contenedor del mapa -->
                    <div class="aspect-video rounded-lg shadow-inner overflow-hidden">
                        <iframe 
                            src="https://www.google.com/maps/d/embed?mid=1-0Zq92S1uA8Stdf8OHh4BratGDG80pU&ehbc=2E312F" 
                            width="100%" 
                            height="100%" 
                            style="border:0;" 
                            allowfullscreen="" 
                            loading="lazy">
                        </iframe>
                    </div>
                </div>
            </div>

            <!-- Fila Inferior (Formulario y Ubicación/Teléfonos) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                
                <!-- Columna Izquierda: Formulario Dinámico -->
                <div x-data="{ tipocita: 'consulta' }" class="bg-white p-6 sm:p-8 rounded-lg shadow-lg">
                    <!-- Icono de Portapapeles con Lápiz (Formulario) -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" clip-rule="evenodd" />
                    <h2 class="text-2xl font-bold text-center text-dark mb-6">Solicitudes en Línea</h2>
                    <form id="contact-form">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="md:col-span-2">
                                <label for="tipocita" class="block text-sm font-medium text-gray-700">Tipo de Gestión</label>
                                <select id="tipocita" name="tipocita" x-model="tipocita" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-accent focus:border-accent">
                                    <option value="consulta">Consulta General</option>
                                    <!--option value="cita">Solicitar Cita</option-->
                                </select>
                            </div>
                            <template x-if="tipocita === 'cita'">
                                <div class="grid grid-cols-2 gap-6 md:col-span-2">
                                    <div>
                                        <label for="fechacita" class="block text-sm font-medium text-gray-700">Fecha Sugerida</label>
                                        <input type="date" name="fechacita" id="fechacita" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                                    </div>
                                    <div>
                                        <label for="horacita" class="block text-sm font-medium text-gray-700">Hora Sugerida</label>
                                        <input type="time" name="horacita" id="horacita" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                                    </div>
                                </div>
                            </template>
                            <div><label for="name" class="block text-sm font-medium text-gray-700">Nombre Completo</label><input type="text" name="name" id="name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                            <div><label for="company" class="block text-sm font-medium text-gray-700">Empresa</label><input type="text" name="company" id="company" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                            <div><label for="email" class="block text-sm font-medium text-gray-700">Email Corporativo</label><input type="email" name="email" id="email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                            <div><label for="phone" class="block text-sm font-medium text-gray-700">Teléfono</label><input type="tel" name="phone" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                            <div class="md:col-span-2"><label for="interest" class="block text-sm font-medium text-gray-700">Área de Interés</label><select id="interest" name="interest" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"><option>Consulta General</option><!--option>Riesgo Psicosocial</option--><option>Sistema SNNAT</option><option>Seguridad y Salud Ocupacional</option><option>Peritos y Acreditaciones</option><option>Generadores de Vapor</option></select></div>
                            <div class="md:col-span-2"><label for="message" class="block text-sm font-medium text-gray-700">Mensaje / Motivo de la Cita</label><textarea id="message" name="message" rows="4" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></textarea></div>
                        </div>
                        <div class="text-center mt-6">
                            <button type="submit" id="submit-button" class="bg-accent text-primary font-bold py-3 px-8 rounded-md hover:bg-yellow-600 transition-colors duration-300">Enviar Solicitud</button>
                        </div>
                    </form>
                    <div id="form-status" class="text-center mt-4 font-semibold"></div>
                </div>

                <!-- Columna Derecha: Mapa y Lista de Teléfonos -->
                    <div class="space-y-8">
                     
                     <div class="bg-white p-6 sm:p-8 rounded-lg shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                        <h3 class="text-2xl font-bold text-dark mb-6 border-b pb-4">Contactos Telefónicos</h3>
                        <dl class="space-y-6">
                           <!-- Item 1: Medidas Sustitutivas -->
                            <div class="flex flex-col sm:flex-row"><dt class="w-full sm:w-1/2 font-semibold text-gray-800">Medidas Sustitutivas:</dt><dd class="w-full sm:w-1/2 mt-1 sm:mt-0"><a href="tel:+50322404132" class="block font-medium text-primary hover:text-accent transition">(+503) 2240-4132</a></dd></div>
                            <!-- Item 2: Comité SSO -->
                            <div class="flex flex-col sm:flex-row"><dt class="w-full sm:w-1/2 font-semibold text-gray-800">Comité SSO:</dt><dd class="w-full sm:w-1/2 mt-1 sm:mt-0 space-y-1"><a href="tel:+50325293998" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3998</a><a href="tel:+50325293999" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3999</a></dd></div>
                            <!-- Item 3: Peritos y Empresas Asesoras -->
                            <div class="flex flex-col sm:flex-row"><dt class="w-full sm:w-1/2 font-semibold text-gray-800">Peritos y Empresas:</dt><dd class="w-full sm:w-1/2 mt-1 sm:mt-0 space-y-1"><a href="tel:+50325293874" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3874</a><a href="tel:+50325293894" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3894</a></dd></div>
                            <!-- Item 4: Generadores de Vapor -->
                            <div class="flex flex-col sm:flex-row"><dt class="w-full sm:w-1/2 font-semibold text-gray-800">Generadores de Vapor:</dt><dd class="w-full sm:w-1/2 mt-1 sm:mt-0 space-y-1"><a href="tel:+50325293824" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3824</a><a href="tel:+50325293892" class="block font-medium text-primary hover:text-accent transition">(+503) 2529-3892</a></dd></div>
                        </dl>
                    </div>
                </div>

            </div>
        </div>
    </section>
   <script is:inline>
  const gasUrl = 'https://script.google.com/macros/s/AKfycbzPv3nfOkT8Ogwuj87JTvviQqeAzJpddgavtr6uHOWGsazrXi4pw6d2Gtd9FKQjNcXk/exec';
  const apiToken = 'DgPs_SeCrEt_ApI_KeY_2024!#';

  document.addEventListener('submit', async (e) => {
    if (e.target.id !== 'contact-form') return;

    e.preventDefault();
    const form = e.target;
    const submitButton = form.querySelector('#submit-button');
    const formStatus = document.querySelector('#form-status');
    
    submitButton.disabled = true;
    submitButton.textContent = 'Enviando...';
    formStatus.textContent = '';
    formStatus.className = 'text-center mt-4 font-semibold';

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.token = apiToken;

    try {
      // CORRECCIÓN #1: Eliminar 'mode: no-cors' y añadir cabeceras.
      const response = await fetch(gasUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'text/plain;charset=utf-8', // Usar text/plain para evitar preflight de CORS
        },
        body: JSON.stringify(data),
      });

      // CORRECCIÓN #2: Leer y procesar la respuesta del servidor.
      const result = await response.json();

      if (result.result === 'success') {
        formStatus.textContent = '¡Gracias! Su solicitud ha sido enviada exitosamente.';
        formStatus.className += ' text-green-600';
        
        Array.from(form.elements).forEach(element => element.disabled = true);
        submitButton.style.display = 'none';
        
        setTimeout(() => window.location.reload(), 3000);
      } else {
        // Muestra el error real que viene del servidor de Google
        throw new Error(result.details || 'Ocurrió un error en el servidor.');
      }

    } catch (error) {
      formStatus.textContent = `Hubo un problema con el envío: ${error.message}`;
      formStatus.className += ' text-red-600';
      console.error('Error en el envío:', error);
      
      submitButton.disabled = false;
      submitButton.textContent = 'Enviar Solicitud';
    }
  });
</script>
</BaseLayout>
